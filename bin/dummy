#!/bin/sh
#
# wrapper sub-script to run security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2012-12-22 kchan

########################################################################
myname=$(basename "$0")
OLD_PWD=$PWD
cd $(dirname "$0")
mydir=${PWD%/}
cd "$OLD_PWD"
########################################################################

# load configurations and helper functions

BASE_DIR="$(dirname $mydir)"
CONFIG="$BASE_DIR/conf/run_audit.conf"
UTILS="$BASE_DIR/bin/utils"

. "$CONFIG"
. "$UTILS"

check_root_user

# run tool

TOOL="email_config"
output_file="$(create_tmpfile)"
trap "rm -f $output_file" EXIT

message()
{
    echo "LOG_DIR: $LOG_DIR"
    echo "EMAIL: $EMAIL"
    echo "
This is a dummy audit script template that sends a test email to the
recipients defined in your run_audit.conf file.

"
    echo "Configuration: $CONFIG"
    echo
    cat "$CONFIG"
    echo
}

if [ "X$EMAIL" != "X" ]; then
    message >"$output_file"
    if [ "X$SUBJECT" != "X" ]; then
        subject="$SUBJECT - ${TOOL} output"
    else
        subject="${TOOL} output"
    fi
    for email in $EMAIL
    do
        notify "$email" "$(date '+%Y-%m-%d') $subject" "$output_file"
    done
else
    message >&2
fi
