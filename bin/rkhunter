#!/bin/sh
#
# rkhunter
# * wrapper script to run rkhunter security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2014-11-01 kchan

PATH=/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/bin:/root/bin

########################################################################
myname="${0##*/}"
current_wd=$PWD
cd $(dirname "$0")
mydir="${PWD%/}"
cd "$current_wd"
########################################################################

# load configurations and helper functions

BASE_DIR="$mydir"
CONFIG_DIR="/etc/audit"
CONFIG="${CONFIG_DIR}/run_audit.conf"
UTILS="${BASE_DIR}/utils"

. "$CONFIG"
. "$UTILS"

check_root_user

# run rkunter audit

SCANNER=$(which rkhunter)
LOGFILE="${LOG_DIR:=/var/log/audit}/rkhunter.log"

makedir "$(dirname $LOGFILE)"

if [ "X$SCANNER" != "X" ] && [ -x "$SCANNER" ]; then
    "$SCANNER" --cronjob --logfile "$LOGFILE"
    if [ -f "$LOGFILE" ]; then
        cat "$LOGFILE"
    else
        error "Scan results not found: $LOGFILE\n"
    fi
else
    error "Unable to execute command: $SCANNER"
fi
