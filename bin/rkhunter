#!/bin/sh
#
# wrapper sub-script to run security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2012-02-05 kchan

########################################################################
myname=`basename $0`
OLD_PWD=$PWD
cd "`dirname $0`"
mydir="${PWD%/}"
cd "$OLD_PWD"
########################################################################

# load configurations and helper functions

BASE_DIR="$(dirname $mydir)"
CONFIG="$BASE_DIR/conf/run_audit.conf"
UTILS="$BASE_DIR/bin/utils"

. "$CONFIG"
. "$UTILS"

check_root_user

# run rkunter audit

RKHUNTER_LOGFILE="/var/log/rkhunter.log"

run_rkhunter()
{
    "$RKHUNTER" --update --nocolors --skip-keypress
    "$RKHUNTER" --cronjob
    cat "$RKHUNTER_LOGFILE"
}

RKHUNTER=$(which rkhunter)

if [ "X$RKHUNTER" != "X" ] && [ -x "$RKHUNTER" ]; then
    run_tool "rkhunter" "run_rkhunter"
fi
