#!/bin/sh
#
# wrapper sub-script to run security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2012-02-05 kchan

########################################################################
myname=`basename $0`
OLD_PWD=$PWD
cd "`dirname $0`"
mydir="${PWD%/}"
cd "$OLD_PWD"
########################################################################

# load configurations and helper functions

BASE_DIR="$(dirname $mydir)"
CONFIG="$BASE_DIR/conf/run_audit.conf"
UTILS="$BASE_DIR/bin/utils"

. "$CONFIG"
. "$UTILS"

# run lsat audit

LSAT=$(which lsat)

run_lsat()
{
    current_wd=$(pwd)
    cd "$LOG_DIR"
    "$LSAT" && {
        if [ -f "lsat.out" ]; then
            echo "### lsat.out"
            cat "lsat.out"
        fi
    }
    cd "$current_wd"
}

if [ "X$LSAT" != "X" ] && [ -x "$LSAT" ]; then
    command_name="lsat"
    command="run_lsat"
    run_tool "$command_name" "$command"

    # output_file="$LOG_DIR/$(basename $LSAT)_$(date '+%Y-%m-%d').log"
    # {
    #     echo "# Start  : $(date '+%Y-%m-%d %H:%M:%S')"
    #     echo
    #     current_wd=$(pwd)
    #     cd "$LOG_DIR"
    #     "$LSAT" && {
    #         if [ -f "lsat.out" ]; then
    #             echo "### lsat.out"
    #             cat "lsat.out"
    #         fi
    #     }
    #     cd "$current_wd"
    #     echo
    #     echo "# Finish : $(date '+%Y-%m-%d %H:%M:%S')"
    # } >"$output_file" 2>&1
    # subject="$SUBJECT - ${LSAT##*/} output"
    # notify "$EMAIL" "$(date '+%Y-%m-%d') $subject" "$output_file"
fi
