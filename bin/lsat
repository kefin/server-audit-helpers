#!/bin/sh
#
# wrapper sub-script to run security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2012-02-05 kchan

########################################################################
myname=`basename $0`
OLD_PWD=$PWD
cd "`dirname $0`"
mydir="${PWD%/}"
cd "$OLD_PWD"
########################################################################

PATH=/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/bin:/root/bin

# load configurations and helper functions

BASE_DIR="$(dirname $mydir)"
CONFIG="$BASE_DIR/conf/run_audit.conf"
UTILS="$BASE_DIR/bin/utils"

. "$CONFIG"
. "$UTILS"

check_root_user

# run lsat audit

LSAT=$(which lsat)

divider="########################################################################"

run_lsat()
{
    current_wd=$(pwd)
    cd "$LOG_DIR"
    {
        "$LSAT" && {
            if [ -f "lsat.out" ]; then
                echo
                echo "$divider"
                echo "# lsat.out"
                cat "lsat.out"
                echo "$divider"
            fi
        }
    } 2>&1
    cd "$current_wd"
}

if [ "X$LSAT" != "X" ] && [ -x "$LSAT" ]; then
    run_tool "lsat" "run_lsat"
fi
