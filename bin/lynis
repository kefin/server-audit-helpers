#!/bin/sh
#
# wrapper sub-script to run security tool
#
# * created: 2012-02-05 Kevin Chan <kefin@makedostudio.com>
# * updated: 2014-10-27 kchan

########################################################################
myname="${0##*/}"
current_wd=$PWD
cd $(dirname "$0")
mydir="${PWD%/}"
cd "$current_wd"
########################################################################

PATH=/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/bin:/root/bin

# load configurations and helper functions

BASE_DIR="$(dirname $mydir)"
CONFIG_DIR="/etc/audit"
CONFIG="${CONFIG_DIR}/run_audit.conf"
UTILS="${BASE_DIR}/bin/utils"

. "$CONFIG"
. "$UTILS"

check_root_user

# run lynis audit

LYNIS=$(which lynis || echo "")

run_lynis()
{
    if [ "X$LYNIS_DIR" != "X" ]; then
        currend_wd=$(pwd)
        cd "$LYNIS_DIR"
        "$LYNIS" -c -Q --auditor "$AUDITOR" --cronjob
        cd "$current_wd"
    else
        "$LYNIS" -c -Q --auditor "$AUDITOR" --cronjob
    fi
}

[ "X$LYNIS" != "X" -a -x "$LYNIS" ] \
    && run_tool "lynis" "run_lynis" \
    || echo >&2 "# unable to execute command: lynis"

